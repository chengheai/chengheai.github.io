---
title: å°ç¨‹åºä¸­ä¼˜é›…çš„èŽ·å–æ‰‹æœºå·
date: 2020-01-08 21:33:09
tags: ['å°ç¨‹åº']
---

## å‰è¨€

æœ€è¿‘åœ¨å†™å°ç¨‹åºé¡¹ç›®ï¼Œæœ‰ä¸ªèŽ·å–æ‰‹æœºå·åŠŸèƒ½ï¼Œç½‘ä¸Šè¡äº†ä¸€ä¸‹ï¼Œè™½ä¸è¯´æ˜¯ä»£ç é—®é¢˜ï¼Œæœ‰äº›æ–‡ç« éƒ½æ˜¯æ®‹ç¼ºä¸å…¨çš„ï¼Œè¯´åˆ°å®¹æ˜“é”™è¯¯çš„åŒºåŸŸåˆå¹¶æœªä½¿ç”¨ä»£ç é¿å…ï¼Œè¯´è€Œä¸åšçš„é—®é¢˜ï¼Œç´¢æ€§è‡ªå·±ç»“åˆç½‘ä¸Šçš„æ–‡ç« åŠå®˜ç½‘æ–‡æ¡£å†™äº†ä¸€å¥—å®Œæ•´çš„ä»£ç ï¼Œå®Œå…¨å¼€ç®±å³ç”¨ ðŸ„ðŸ»â€â™‚ï¸ðŸ®ðŸŽ¹ðŸ¸

## æ•ˆæžœ

![](https://github.com/chengheai/review-demo-image/blob/master/WX20200108-214825@2x.png?raw=true)

## ä»£ç 

```javascript
//Page Object
Page({
  data: {},
  getPhoneNumber: function(e) {
    let that = this;
    console.log('e', e);
    //-----------------æ˜¯å¦æŽˆæƒï¼ŒæŽˆæƒé€šè¿‡è¿›å…¥ä¸»é¡µé¢ï¼ŒæŽˆæƒæ‹’ç»åˆ™åœç•™åœ¨ç™»å½•ç•Œé¢
    if (e.detail.errMsg == 'getPhoneNumber:fail user deny') {
      //ç”¨æˆ·ç‚¹å‡»æ‹’ç»
      wx.showModal({
        content: 'è¯·è¾“å…¥æ‰‹æœºå·',
        showCancel: false,
        success(res) {
          if (res.confirm) {
            // your code ...
          }
        },
      });
    } else {
      let phoneQuery = {
        encryptedData: e.detail.encryptedData,
        iv: e.detail.iv,
        // other params...
        openid: wx.getStorageSync('openid'),
      };
      // æ£€æŸ¥æ˜¯session_keyå¦è¿‡æœŸ
      wx.checkSession({
        success() {
          //session_key æœªè¿‡æœŸï¼Œå¹¶ä¸”åœ¨æœ¬ç”Ÿå‘½å‘¨æœŸä¸€ç›´æœ‰æ•ˆ
          console.log('session_key æœªè¿‡æœŸï¼Œå¹¶ä¸”åœ¨æœ¬ç”Ÿå‘½å‘¨æœŸä¸€ç›´æœ‰æ•ˆ');
          wx.request({
            url: 'https://xxx.com/api/v1/xx',
            method: 'POST',
            data: phoneQuery,
            success: function(res) {
              // your code...
            },
            fail: function(err) {
              // your code...
            },
          });
        },
        fail() {
          that.myLogin();
          // session_key å·²ç»å¤±æ•ˆï¼Œéœ€è¦é‡æ–°æ‰§è¡Œç™»å½•æµç¨‹
        },
      });
    }
  },
  // login
  myLogin() {
    wx.login({
      success: res => {
        //ç”¨codeä¼ ç»™æœåŠ¡å™¨è°ƒæ¢session_key
        let query = {
          code: res.code,
        };
        // my_loginä¸ºwx.request({})å°è£…
        my_login(query).then(res => {
          // other code...
          wx.setStorageSync('unionid', unionid);
        });
      },
    });
  },
  //options(Object)
  onLoad: function(options) {},
  onReady: function() {},
  onShow: function() {},
  onHide: function() {},
  onUnload: function() {},
  onPullDownRefresh: function() {},
  onReachBottom: function() {},
  onShareAppMessage: function() {},
  onPageScroll: function() {},
  //item(index,pagePath,text)
  onTabItemTap: function(item) {},
});
```
